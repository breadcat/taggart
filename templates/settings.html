{{template "_header" .}}
<h1>Settings</h1>

{{if .Data.Error}}
<div style="background-color: #f8d7da; color: #721c24; padding: 10px; border: 1px solid #f5c6cb; border-radius: 4px; margin-bottom: 20px;">
    <strong>Error:</strong> {{.Data.Error}}
</div>
{{end}}

{{if .Data.Success}}
<div style="background-color: #d4edda; color: #155724; padding: 10px; border: 1px solid #c3e6cb; border-radius: 4px; margin-bottom: 20px;">
    <strong>Success:</strong> {{.Data.Success}}
</div>
{{end}}

<form method="post" style="max-width: 600px;">
    <div style="margin-bottom: 20px;">
        <label for="database_path" style="display: block; font-weight: bold; margin-bottom: 5px;">Database Path:</label>
        <input type="text" id="database_path" name="database_path" value="{{.Data.Config.DatabasePath}}" required
               style="width: 100%; padding: 8px; font-size: 14px;"
               placeholder="./database.db">
        <small style="color: #666;">Path to SQLite database file (requires restart if changed)</small>
    </div>

    <div style="margin-bottom: 20px;">
        <label for="upload_dir" style="display: block; font-weight: bold; margin-bottom: 5px;">Upload Directory:</label>
        <input type="text" id="upload_dir" name="upload_dir" value="{{.Data.Config.UploadDir}}" required
               style="width: 100%; padding: 8px; font-size: 14px;"
               placeholder="uploads">
        <small style="color: #666;">Directory where uploaded files are stored</small>
    </div>

    <div style="margin-bottom: 20px;">
        <label for="server_port" style="display: block; font-weight: bold; margin-bottom: 5px;">Server Port:</label>
        <input type="text" id="server_port" name="server_port" value="{{.Data.Config.ServerPort}}" required
               style="width: 100%; padding: 8px; font-size: 14px;"
               placeholder=":8080">
        <small style="color: #666;">Port for web server (format: :8080, requires restart if changed)</small>
    </div>

    <div style="margin-bottom: 20px;">
        <label for="instance_name" style="display: block; font-weight: bold; margin-bottom: 5px;">Instance Name:</label>
        <input type="text" id="instance_name" name="instance_name" value="{{.Data.Config.InstanceName}}" required
               style="width: 100%; padding: 8px; font-size: 14px;"
               placeholder="Taggart">
        <small style="color: #666;">Instance Name, used in header and title bar</small>
    </div>

    <div style="margin-bottom: 20px;">
        <label for="gallery_size" style="display: block; font-weight: bold; margin-bottom: 5px;">Gallery Size:</label>
        <input type="text" id="gallery_size" name="gallery_size" value="{{.Data.Config.GallerySize}}" required
               style="width: 100%; padding: 8px; font-size: 14px;"
               placeholder="400px">
        <small style="color: #666;">Size of previews used in galleries</small>
    </div>

    <div style="margin-bottom: 20px;">
        <label for="items_per_page" style="display: block; font-weight: bold; margin-bottom: 5px;">Items per Page:</label>
        <input type="text" id="items_per_page" name="items_per_page" value="{{.Data.Config.ItemsPerPage}}" required
               style="width: 100%; padding: 8px; font-size: 14px;"
               placeholder="100">
        <small style="color: #666;">Items per page in galleries</small>
    </div>

    <button type="submit" style="background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">
        Save Settings
    </button>
</form>

<hr style="margin: 40px 0;">

<h2>Tag Aliases</h2>
<p style="color: #666; margin-bottom: 20px;">
    Define tag aliases so that multiple tag values are treated as equivalent when searching or filtering.
    For example, if you alias "colour/blue" with "colour/navy", searching for either will show files tagged with both.
</p>

<div id="aliases-section" style="max-width: 800px;">
    <div id="alias-groups"></div>

    <button onclick="addAliasGroup()" style="background-color: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 4px; font-size: 14px; cursor: pointer; margin-top: 10px;">
        + Add Alias Group
    </button>

    <form method="post" id="aliases-form" style="margin-top: 20px;">
        <input type="hidden" name="action" value="save_aliases">
        <input type="hidden" name="aliases_json" id="aliases_json">
        <button type="submit" style="background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">
            Save Aliases
        </button>
    </form>
</div>

<script>window.initialAliasGroups = {{.Data.Config.TagAliases}};</script><script src="/static/tag-alias.js" defer></script>

<div style="margin-top: 40px; padding: 20px; background-color: #f8f9fa; border-radius: 5px;">
    <h3>Current Configuration:</h3>
    <ul>
        <li><strong>Database:</strong> {{.Data.Config.DatabasePath}}</li>
        <li><strong>Upload Directory:</strong> {{.Data.Config.UploadDir}}</li>
        <li><strong>Server Port:</strong> {{.Data.Config.ServerPort}}</li>
        <li><strong>Instance Name:</strong> {{.Data.Config.InstanceName}}</li>
        <li><strong>Gallery Size:</strong> {{.Data.Config.GallerySize}}</li>
        <li><strong>Items per Page:</strong> {{.Data.Config.ItemsPerPage}}</li>
    </ul>

    <h4>Configuration File:</h4>
    <p>Settings are stored in <code>config.json</code> in the application directory.</p>
</div>

<hr style="margin: 40px 0;">

<h2>Database Maintenance</h2>

<form method="post" style="margin-bottom: 20px;">
    <input type="hidden" name="action" value="backup">
    <button type="submit" style="background-color: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">
        Backup Database
    </button>
    <small style="color: #666; margin-left: 10px;">Creates a timestamped backup of the database file</small>
</form>

<form method="post">
    <input type="hidden" name="action" value="vacuum">
    <button type="submit" style="background-color: #6f42c1; color: white; padding: 10px 20px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">
        Vacuum Database
    </button>
    <small style="color: #666; margin-left: 10px;">Reclaims unused space and optimizes database performance</small>
</form>

{{template "_footer"}}
