{{template "_header" .}}
<h1>Thumbnail Management</h1>

{{if .Data.Error}}
<div style="background-color: #f8d7da; color: #721c24; padding: 10px; border: 1px solid #f5c6cb; border-radius: 4px; margin-bottom: 20px;">
    <strong>Error:</strong> {{.Data.Error}}
</div>
{{end}}

{{if .Data.Success}}
<div style="background-color: #d4edda; color: #155724; padding: 10px; border: 1px solid #c3e6cb; border-radius: 4px; margin-bottom: 20px;">
    <strong>Success:</strong> {{.Data.Success}}
</div>
{{end}}

<!-- Tab Navigation -->
<div style="margin-bottom: 20px; border-bottom: 2px solid #ddd;">
    <button onclick="showTab('missing')" id="tab-missing" style="padding: 10px 20px; border: none; background: none; cursor: pointer; border-bottom: 3px solid #007bff; font-weight: bold;">
        Missing ({{len .Data.MissingThumbnails}})
    </button>
    <button onclick="showTab('all')" id="tab-all" style="padding: 10px 20px; border: none; background: none; cursor: pointer; border-bottom: 3px solid transparent;">
        All Videos ({{len .Data.AllVideos}})
    </button>
</div>

<!-- Missing Thumbnails Tab -->
<div id="content-missing" style="margin-bottom: 30px;">
    <h2>Missing Thumbnails ({{len .Data.MissingThumbnails}})</h2>

    {{if .Data.MissingThumbnails}}
        <form method="post" action="/thumbnails/generate" style="margin-bottom: 20px;">
            <input type="hidden" name="action" value="generate_all">
            <button type="submit" onclick="return confirm('Generate thumbnails for all {{len .Data.MissingThumbnails}} videos? This may take a while.');" style="background-color: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">
                Generate All Missing Thumbnails
            </button>
            <small style="color: #666; margin-left: 10px;">Uses timestamp 00:00:05 for all videos</small>
        </form>

        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
            {{range .Data.MissingThumbnails}}
            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background-color: #f8f9fa;">
                <h3 style="margin-top: 0; font-size: 14px; word-break: break-word;">
                    <a href="/file/{{.ID}}" target="_blank">{{.Filename}}</a>
                </h3>
                <p style="color: #666; font-size: 12px; margin: 5px 0;">ID: {{.ID}}</p>

                <video width="100%" style="max-height: 200px; background: #000; margin: 10px 0; cursor: pointer;" title="Click to capture frame">
                    <source src="/uploads/{{.EscapedFilename}}">
                </video>

                <form method="post" action="/thumbnails/generate" style="margin-top: 10px;">
                    <input type="hidden" name="action" value="generate_single">
                    <input type="hidden" name="file_id" value="{{.ID}}">

                    <div style="display: flex; gap: 5px; align-items: center; margin-bottom: 10px;">
                        <label style="font-size: 13px; white-space: nowrap;">Timestamp:</label>
                        <input type="text" name="timestamp" value="00:00:05" placeholder="00:00:05"
                               style="flex: 1; padding: 5px; font-size: 13px; font-family: monospace;">
                    </div>

                    <button type="submit" style="background-color: #007bff; color: white; padding: 6px 12px; border: none; border-radius: 3px; font-size: 13px; cursor: pointer; width: 100%;">
                        Generate Thumbnail
                    </button>
                </form>
            </div>
            {{end}}
        </div>
    {{else}}
        <div style="padding: 20px; background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 4px;">
            <strong>✓ All videos have thumbnails!</strong>
        </div>
    {{end}}
</div>

<!-- All Videos Tab -->
<div id="content-all" style="margin-bottom: 30px; display: none;">
    <h2>Regenerate Thumbnail</h2>

    <div style="margin-bottom: 20px; padding: 10px; background-color: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 4px;">
        <strong>Tip:</strong> Enter a file ID to regenerate its thumbnail with a custom timestamp. You can find file IDs in the URL when viewing a file (e.g., /file/312).
    </div>

    <form method="post" action="/thumbnails/generate" style="max-width: 500px; padding: 20px; background-color: #f8f9fa; border: 1px solid #ddd; border-radius: 5px;">
        <input type="hidden" name="action" value="generate_single">

        <div style="margin-bottom: 20px;">
            <label for="file_id" style="display: block; font-weight: bold; margin-bottom: 5px;">File ID:</label>
            <input type="text" id="file_id" name="file_id" required
                   style="width: 100%; padding: 8px; font-size: 14px; font-family: monospace;"
                   placeholder="e.g., 312">
            <small style="color: #666;">Enter the ID of the video file</small>
        </div>

        <div style="margin-bottom: 20px;">
            <label for="timestamp" style="display: block; font-weight: bold; margin-bottom: 5px;">Timestamp:</label>
            <input type="text" id="timestamp" name="timestamp" value="00:00:05" required
                   style="width: 100%; padding: 8px; font-size: 14px; font-family: monospace;"
                   placeholder="00:00:05">
            <small style="color: #666;">Format: HH:MM:SS (e.g., 00:00:05 for 5 seconds)</small>
        </div>

        <button type="submit" style="background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; width: 100%;">
            Generate/Regenerate Thumbnail
        </button>
    </form>

    {{if .Data.Success}}
    <div class="auto-hide-success" style="margin-top: 20px; padding: 15px; background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 4px;">
        <strong>✓ Success!</strong> {{.Data.Success}}
    </div>
    {{end}}
</div>

<script src="/static/thumbnails.js" defer></script>

{{template "_footer"}}